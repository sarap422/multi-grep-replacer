# 1_requirements.md（要件定義）

## 📋 1.1 問題の明確化と動機の整理

### 現状の問題を明確にする
- **何が不便か？** 
  - サクラエディタのGrep置換では、複数の置換パターンを一つずつ手動で実行する必要がある
  - Python版Multi Grep ReplacerのGUIボタン反応が悪く、何度もクリックしないと動作しない
  - VS Code等の拡張機能は設定が複雑で、一時的な置換作業には向かない
  - 既存のツールはWindows専用が多く、Mac環境では使えない

- **どのくらい時間がかかるか？** 
  - 5つの置換パターンなら5回の操作が必要（サクラエディタ）
  - Python版では各ボタンで複数回クリックが必要（UI応答性問題）
  - 各操作でフォルダ選択、拡張子設定、検索文字列入力を繰り返す
  - 設定ミスによる手戻りが発生しやすい

- **頻度は？** 
  - Web開発で頻繁に発生（CSS class名の統一、変数名のリファクタリングなど）
  - プロジェクト移行時のパス変更、ブランド名変更等
  - 週に数回〜毎日の作業

### 解決したい範囲を決める
- **対象ファイル**: テキストファイル全般（HTML, CSS, JS, PHP, TXT, MD, JSON, XML等）
- **対象環境**: Mac・Windows両方で同じ操作感、UI応答性の大幅改善
- **使用シーン**: 個人開発での一括置換作業、小〜中規模プロジェクトのリファクタリング

## 📝 1.2 基本情報の整理

### プロダクト名
**Multi Grep Replacer (Electron Edition)**

### アプリケーション名
- MultiGrepReplacer.app (Mac)
- MultiGrepReplacer.exe (Windows)

### 概要
任意のフォルダパス（サブフォルダを含む）内のファイルの内容を、複数の検索・置換パターンで、一括で順次Grep置換できるクロスプラットフォーム対応デスクトップアプリケーション（Electron製）

### ターゲットユーザー
- **プライマリ**: Web開発者、フロントエンドエンジニア（Python版で不満を感じているユーザー）
- **セカンダリ**: テキスト処理を頻繁に行う人（ライター、翻訳者、システム管理者）
- **サード**: サクラエディタ等の単発置換に不満を持つ人、MacユーザーでGrep置換ツールを探している人

### 想定利用シーン
1. **CSSクラス名の一括変更**: `old-class` → `new-class` など
2. **変数名のリファクタリング**: `oldVariable` → `newVariable` など  
3. **APIエンドポイントの変更**: `api/v1/` → `api/v2/` など
4. **ブランド名・会社名の変更**: `OldCompany` → `NewCompany` など
5. **文字エンコーディングの統一**: `charset=Shift_JIS` → `charset=UTF-8` など
6. **フレームワーク移行**: Bootstrap v3 → v4/5 のクラス名一括変更

## ⚙️ 1.3 機能要件

### 主要機能

#### 1. 複数置換ルールの管理（UI応答性重視）
- ✅ **ルール追加**: 「+」ボタンで新しい置換ルールを追加（即座に反応）
- ✅ **ルール削除**: 「×」ボタンで不要なルールを削除（ワンクリックで動作）
- ✅ **ルール編集**: From/To フィールドで検索・置換文字列を入力（タイピング遅延なし）
- ✅ **ルール順序**: 上から順番に実行（ドラッグ&ドロップでの並び替え対応）
- ✅ **ルール一時無効化**: チェックボックスで個別ルールのON/OFF切り替え

#### 2. ファイル検索・絞り込み（高速化）
- ✅ **フォルダ指定**: Browse ボタンでフォルダを選択（ネイティブダイアログ）
- ✅ **再帰検索**: 指定フォルダ配下のサブフォルダも含めて検索
- ✅ **拡張子フィルタ**: カンマ区切りで複数拡張子を指定（例: `.html,.css,.js,.php`）
- ✅ **全ファイル対象**: 拡張子フィールドを空にすると全ファイルが対象
- ✅ **除外パターン**: node_modules, .git等の不要フォルダを自動除外
- ✅ **プレビュー機能**: 対象ファイル一覧の事前表示

#### 3. 置換実行・結果表示（パフォーマンス向上）
- ✅ **一括実行**: 設定した全ルールを順次実行（非同期処理でUIフリーズ防止）
- ✅ **進捗表示**: リアルタイム進捗バー、現在処理中ファイル名表示
- ✅ **実行結果表示**: 変更されたファイル数、総変更箇所数を表示
- ✅ **詳細ログ**: どのファイルで何箇所変更されたかを一覧表示
- ✅ **エラーハンドリング**: ファイルアクセス不可等のエラーを適切に表示
- ✅ **結果エクスポート**: 実行結果をCSV/JSON形式で保存

#### 4. 設定管理（強化）
- ✅ **設定保存**: 現在の置換ルールをJSONファイルに保存
- ✅ **設定読み込み**: 保存した設定ファイルを読み込んで復元
- ✅ **設定ファイル形式**: 人間が読みやすいJSON形式
- ✅ **最近使用した設定**: 履歴から設定を呼び出し
- ✅ **設定テンプレート**: よく使うパターンをテンプレート化

#### 5. Modern UI/UX（新機能）
- ✅ **ダークモード対応**: システム設定に連動したテーマ切り替え
- ✅ **キーボードショートカット**: Ctrl+S（設定保存）、Ctrl+E（実行）等
- ✅ **ドラッグ&ドロップ**: フォルダや設定ファイルのドロップ対応
- ✅ **ウィンドウ状態記憶**: サイズ、位置の記憶・復元
- ✅ **tooltips**: 各機能の説明をホバーで表示

### 非機能要件

#### パフォーマンス（大幅改善）
- ✅ **処理速度**: 1000ファイル以下で30秒以内に完了
- ✅ **UI応答性**: ボタンクリック100ms以内に反応（Python版の課題解決）
- ✅ **メモリ使用量**: 通常のテキストファイルなら200MB以下
- ✅ **CPU使用率**: 置換処理中でも他アプリケーションに影響しない

#### 互換性・可用性
- ✅ **クロスプラットフォーム**: Mac・Windows両方で同一操作・同一見た目
- ✅ **依存関係**: Electronの自己完結型（Node.js内蔵）
- ✅ **インストール**: ダブルクリックで起動可能（.app/.exe形式で配布）
- ✅ **アップデート**: アプリ内での自動更新通知

#### セキュリティ・安全性
- ✅ **データ保護**: バックアップ機能は提供しない（Git等の利用を前提）
- ✅ **ファイル権限**: 書き込み権限のないファイルは適切にスキップ
- ✅ **入力検証**: 不正な入力値に対する適切なエラー処理
- ✅ **sandboxing**: Electronセキュリティベストプラクティス準拠

#### ユーザビリティ（重点改善項目）
- ✅ **直感的操作**: 初回利用でも3分以内に理解可能
- ✅ **軽快なUI**: ボタンクリックの即座反応（Python版の課題解決）
- ✅ **エラー対応**: エラーメッセージが分かりやすく、解決方法も提示
- ✅ **学習容易性**: ツールチップ、ヘルプ機能の充実

## 🎨 1.4 画面・UI設計

### メインウィンドウレイアウト（Modern Design）
```
┌───────────────────────────────────────────────────────────────────┐
│ Multi Grep Replacer                                    🌙 ⚙️ ❌    │
├───────────────────────────────────────────────────────────────────┤
│                                                                   │
│ 📁 Target Folder                                                  │
│ ┌─────────────────────────────────────────────┐ 📂 Browse...       │
│ │ /path/to/project/folder                     │                   │
│ └─────────────────────────────────────────────┘                   │
│                                                                   │
│ 🔍 File Extensions (comma-separated, blank = all files)           │
│ ┌─────────────────────────────────────────────────────────────┐   │
│ │ .html,.css,.js,.jsx,.tsx,.vue,.php                               │   │
│ └─────────────────────────────────────────────────────────────┘   │
│                                                                   │
│ ⚙️ Replacement Rules                         📋 Templates ▼      │
│ ┌─────────────────────────────────────────────────────────────┐   │
│ │ ☑️ From: ┌───────────────┐ → To: ┌───────────────┐ 🗑️ ↕️   │   │
│ │         │ old-class     │       │ new-class     │           │   │
│ │         └───────────────┘       └───────────────┘           │   │
│ │                                                             │   │
│ │ ☑️ From: ┌───────────────┐ → To: ┌───────────────┐ 🗑️ ↕️   │   │
│ │         │ oldVariable   │       │ newVariable   │           │   │
│ │         └───────────────┘       └───────────────┘           │   │
│ │                                                             │   │
│ │ ➕ Add new rule                                             │   │
│ └─────────────────────────────────────────────────────────────┘   │
│                                                                   │
│ 📊 Preview: 156 files found, 3 rules active                      │
│                                                                   │
├───────────────────────────────────────────────────────────────────┤
│ 💾 Load Config   💾 Save Config        🚀 Execute Replacement     │
└───────────────────────────────────────────────────────────────────┘
```

### UI操作フロー（改善版）
1. **フォルダ選択**: Browse ボタンまたはドラッグ&ドロップでターゲットフォルダを選択
2. **拡張子設定**: 対象ファイルの拡張子をカンマ区切りで入力（空欄=全ファイル）
3. **プレビュー確認**: 対象ファイル数をリアルタイム表示
4. **ルール設定**: From/To フィールドで置換ルールを設定（即座入力反映）
5. **ルール管理**: ➕でルール追加、🗑️で削除、☑️で有効/無効切り替え
6. **並び替え**: ↕️アイコンでドラッグ&ドロップによるルール順序変更
7. **設定保存**: 💾 Save Config で設定をJSONファイルに保存
8. **設定読み込み**: 💾 Load Config で保存した設定を読み込み
9. **実行**: 🚀 Execute Replacement で一括置換を実行

### 実行進捗・結果表示ウィンドウ
```
┌───────────────────────────────────────────────────────────────────┐
│ 🚀 Executing Replacements...                                     │
├───────────────────────────────────────────────────────────────────┤
│                                                                   │
│ ████████████████████████░░░░░░░░░░░░ 67% (102/156 files)         │
│                                                                   │
│ 📄 Currently processing: /project/styles/main.css                │
│                                                                   │
│ ⏱️ Elapsed: 00:12  📊 Changes made: 47                          │
│                                                                   │
├───────────────────────────────────────────────────────────────────┤
│                                            ⏸️ Pause   ⏹️ Stop     │
└───────────────────────────────────────────────────────────────────┘
```

### 完了結果ウィンドウ（詳細版）
```
┌───────────────────────────────────────────────────────────────────┐
│ ✅ Replacement Completed Successfully!                             │
├───────────────────────────────────────────────────────────────────┤
│                                                                   │
│ 📊 Summary: 15 files modified with 42 total changes               │
│ ⏱️ Completed in: 00:23                                           │
│                                                                   │
│ ┌─────────────────────────────────────────────────────────────┐   │
│ │ ✅ /path/to/file1.css (3 changes)                           │   │
│ │    - old-class → new-class (2 occurrences)                  │   │
│ │    - oldVariable → newVariable (1 occurrence)               │   │
│ │                                                             │   │
│ │ ✅ /path/to/file2.html (7 changes)                          │   │
│ │    - old-class → new-class (5 occurrences)                  │   │
│ │    - oldVariable → newVariable (2 occurrences)              │   │
│ │                                                             │   │
│ │ ✅ /path/to/file3.js (2 changes)                            │   │
│ │ ...                                                         │   │
│ └─────────────────────────────────────────────────────────────┘   │
│                                                                   │
│ 📤 Export Results   📋 Copy Summary        ✅ Close               │
└───────────────────────────────────────────────────────────────────┘
```

## 🚫 対象外・制限事項

### 対象外機能（v1.0では）
- ❌ **正規表現サポート**: 初版では文字列マッチのみ（v2.0で検討）
- ❌ **リアルタイム監視**: ファイル変更の自動検知は行わない
- ❌ **クラウド同期**: 設定のクラウド保存・同期機能
- ❌ **プラグインシステム**: サードパーティ拡張機能
- ❌ **AI機能**: 自動置換提案等の機械学習機能

### 制限事項
- 📁 **ファイルサイズ**: 1ファイル100MB超は動作保証外
- 📁 **ファイル数**: 10,000ファイル超は処理時間が長くなる可能性
- 📁 **文字エンコーディング**: UTF-8前提（他エンコーディングは保証外）
- 📁 **バイナリファイル**: 対象外（テキストファイルのみ）
- 📁 **同時実行**: 複数インスタンスでの同一ファイル操作は非対応
- 📁 **ネットワークドライブ**: ローカルファイルシステムのみ対応

### 前提条件
- 💻 **実行環境**: macOS 10.14+, Windows 10+
- 💻 **権限**: 対象ファイル・フォルダへの読み書き権限
- 💻 **ディスク容量**: アプリサイズ150MB程度（Electronアプリ特性）
- 💻 **メモリ**: 最低2GB（推奨4GB以上）

## 🎯 1.5 Python版からの改善点（重要）

### UI/UX改善
1. **ボタン反応性**: 複数クリック不要、即座の反応
2. **モダンデザイン**: CSS3によるフラットデザイン、アニメーション
3. **操作性向上**: ドラッグ&ドロップ、キーボードショートカット対応
4. **視認性改善**: アイコン使用、色分けによる状態表示

### 機能改善
1. **プレビュー機能**: 実行前の対象ファイル確認
2. **進捗表示**: リアルタイム進捗バー
3. **結果詳細化**: ファイル別、ルール別の変更内容表示
4. **設定管理強化**: テンプレート、履歴機能

### パフォーマンス改善
1. **応答性**: UI操作の即座反応
2. **非同期処理**: 大容量ファイル処理でもUIフリーズなし
3. **メモリ効率**: Stream処理による大容量ファイル対応
4. **処理速度**: Node.js の高速ファイル操作

このElectron版により、Python版の課題であったUI応答性を根本的に解決し、モダンで使いやすいアプリケーションを実現します。